{% extends "base.html" %}

{% block stylesheets %}
<style>
    /* --- Creator Theme Specifics --- */
    .grail-card {
        background: #fff; border: 1px solid #f1f1f1; border-radius: 16px;
        transition: transform 0.2s, box-shadow 0.2s; overflow: hidden; height: 100%;
        display: flex; flex-direction: column; cursor: pointer;
    }
    .grail-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-color: #C89E47; }
    
    /* Card Header */
    .card-top { padding: 20px; flex-grow: 1; }
    .task-meta { font-size: 0.75rem; color: #6B7280; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }
    .task-title { font-size: 1.15rem; font-weight: 700; color: #1F2937; margin: 10px 0; line-height: 1.4; }
    .task-desc { font-size: 0.9rem; color: #6B7280; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    /* Card Footer */
    .card-btm { padding: 15px 20px; background: #F9FAFB; border-top: 1px solid #f3f4f6; display: flex; justify-content: space-between; align-items: center; }
    
    /* Status Badges */
    .status-badge { padding: 5px 12px; border-radius: 30px; font-size: 0.75rem; font-weight: 600; }
    .st-todo { background: #E5E7EB; color: #374151; }
    .st-review { background: #FEF3C7; color: #D97706; }
    .st-completed { background: #D1FAE5; color: #059669; }
    .st-blocked { background: #FEE2E2; color: #DC2626; }

    /* --- New Modal Layout (Reference Image Style) --- */
    .modal-sidebar { background: #F8F9FA; border-right: 1px solid #eee; }
    .detail-block { background: #fff; border: 1px solid #eee; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    .detail-label { font-size: 0.75rem; color: #9CA3AF; font-weight: 600; text-transform: uppercase; margin-bottom: 4px; display: block; }
    .detail-value { font-size: 0.95rem; color: #111; font-weight: 600; }
    
    .tag-badge { background: #fff; border: 1px solid #eee; color: #555; font-size: 0.8rem; padding: 4px 10px; border-radius: 4px; display: inline-block; margin: 2px; }

    /* File Lists */
    .file-list-container { max-height: 200px; overflow-y: auto; padding-right: 5px; }
    .file-item { display: flex; align-items: center; padding: 10px; background: #fff; border: 1px solid #E5E7EB; border-radius: 8px; margin-bottom: 8px; }
    .file-icon { width: 36px; height: 36px; background: #F3F4F6; border-radius: 6px; display: flex; align-items: center; justify-content: center; margin-right: 12px; color: #666; font-size: 1.2rem; }
    .file-thumb { width: 36px; height: 36px; border-radius: 6px; object-fit: cover; margin-right: 12px; }
    
    /* Upload Zone */
    .upload-dropzone { border: 2px dashed #E5E7EB; border-radius: 12px; padding: 25px; text-align: center; cursor: pointer; transition: 0.2s; background: #F9FAFB; }
    .upload-dropzone:hover { border-color: #C89E47; background: #fff; }
</style>
{% endblock stylesheets %}

{% block user_page %}
<div class="main-div">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 pt-3 px-3 g-3">
        <div>
            <h2 class="fw-bold text-dark mb-0">Creator Dashboard</h2>
            <p class="text-muted small mb-0">View assignments and submit your work.</p>
        </div>
        
        <div class="btn-group shadow-sm rounded-pill bg-white p-1 mt-3 mt-md-0">
            <button class="btn btn-sm btn-light rounded-pill px-3 active filter-btn" data-filter="all">All</button>
            <button class="btn btn-sm btn-light rounded-pill px-3 filter-btn" data-filter="To Do">To Do</button>
            <button class="btn btn-sm btn-light rounded-pill px-3 filter-btn" data-filter="In Review">In Review</button>
            <button class="btn btn-sm btn-light rounded-pill px-3 filter-btn" data-filter="Completed">Done</button>
        </div>
    </div>

    <div class="row g-4 px-2" id="taskGrid">
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-warning"></div>
        </div>
    </div>
</div>

<div class="modal fade" id="submissionModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden; min-height: 600px;">
            <div class="modal-body p-0">
                <div class="row g-0 h-100">
                    
                    <div class="col-lg-4 modal-sidebar p-4 h-100" style="overflow-y: auto;">
                        <h5 class="fw-bold mb-3" id="modalTitle">Task Title</h5>
                        
                        <div class="mb-3">
                            <span class="detail-label">Description</span>
                            <p class="text-muted small" id="modalDesc" style="white-space: pre-line;">No description.</p>
                        </div>
                        
                        <div class="row g-2 mb-2">
                             <div class="col-6">
                                <div class="detail-block">
                                    <span class="detail-label">Context</span>
                                    <span class="detail-value" id="modalContext">-</span>
                                </div>
                            </div>
                             <div class="col-6">
                                <div class="detail-block">
                                    <span class="detail-label">Type</span>
                                    <span class="detail-value" id="modalType">-</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="detail-block">
                                    <span class="detail-label">Quantity</span>
                                    <span class="detail-value" id="modalQty">-</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="detail-block">
                                    <span class="detail-label">Duration</span>
                                    <span class="detail-value" id="modalDuration">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                             <span class="detail-label mb-2">Requirements</span>
                             <div class="d-flex gap-2">
                                 <span class="badge bg-white border text-secondary p-2 fw-normal" id="modalFace"><i class="ri-checkbox-circle-line"></i> Face</span>
                                 <span class="badge bg-white border text-secondary p-2 fw-normal" id="modalWatermark"><i class="ri-close-circle-line"></i> Watermark</span>
                             </div>
                        </div>

                        <div class="mb-3">
                            <span class="detail-label mb-2">Outfit / Tags</span>
                            <div id="modalTags" class="d-flex flex-wrap"></div>
                        </div>
                    </div>

                    <div class="col-lg-8 p-4 d-flex flex-column h-100 bg-white" style="overflow-y: auto;">
                         <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="fw-bold m-0">Submission Details</h5>
                             <div class="d-flex gap-2">
                                 <button class="btn btn-light text-primary btn-sm rounded-pill" id="btnOpenChat">
                                    <i class="ri-message-3-line me-1"></i> Chat
                                </button>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                             </div>
                        </div>

                        <div class="mb-4">
                             <h6 class="fw-bold small text-muted mb-2"><i class="ri-attachment-line"></i> Reference Files (From Manager)</h6>
                             <div class="file-list-container bg-light rounded-3 p-3 border" id="modalReferences">
                                 <small class="text-muted">No reference files provided.</small>
                             </div>
                        </div>

                        <div class="flex-grow-1">
                             <h6 class="fw-bold small text-muted mb-2"><i class="ri-upload-cloud-2-line"></i> Your Work</h6>
                             
                             <div class="alert alert-warning border-0 d-flex align-items-center p-2 mb-3 small" id="statusAlert">
                                <i class="ri-loader-4-line me-2"></i> <span>Upload your work below.</span>
                            </div>
                             
                             <div class="row g-3 h-100">
                                 <div class="col-md-5">
                                     <div class="upload-dropzone h-100 d-flex flex-column justify-content-center" id="dropZone">
                                        <i class="ri-add-circle-fill fs-1 text-warning mb-2"></i>
                                        <h6 class="fw-bold text-dark">Upload Files</h6>
                                        <p class="text-muted small mb-0">Images, Videos, Docs</p>
                                        <input type="file" id="fileInput" multiple hidden>
                                    </div>
                                 </div>
                                 <div class="col-md-7">
                                     <div class="file-list-container bg-light rounded-3 p-3 border h-100" id="deliverablesList">
                                          <p class="text-muted small text-center mt-3">No files uploaded yet.</p>
                                     </div>
                                 </div>
                             </div>
                        </div>
                        
                        <div class="mt-4 pt-3 border-top">
                             <label class="detail-label mb-2">Comment (Optional)</label>
                             <textarea class="form-control bg-light border-0 mb-3 shadow-none" id="submissionComment" rows="2" placeholder="Add a note for the manager..."></textarea>
                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-light rounded-pill me-2 px-4" data-bs-dismiss="modal">Close</button>
                                <button class="btn btn-grail-gold rounded-pill px-4" id="btnSubmitWork">
                                    <i class="ri-check-double-line me-1"></i> Submit Work
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 16px;">
            <div class="modal-header bg-white border-bottom p-3">
                <h6 class="mb-0 fw-bold">Task Chat</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="bg-light p-0" style="height: 400px; overflow-y: auto;" id="chatContainer"></div>
            <div class="p-3 bg-white border-top">
                <form id="chatForm" class="d-flex gap-2">
                    <input type="text" class="form-control rounded-pill border-0 bg-light shadow-none" id="chatInput" placeholder="Message..." autocomplete="off">
                    <button type="submit" class="btn btn-grail-gold rounded-circle"><i class="ri-send-plane-fill"></i></button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script src="{{ url_for('static', path='/js/task_management/task_submission.js') }}"></script>
{% endblock %}